language: csharp
solution: Twilio.sln
mono: latest
dotnet: 3.1

env:
  - FrameworkPathOverride=/usr/lib/mono/4.5/

services:
  - docker

script:
  - make test
  - make release

deploy:
  - provider: script
    script: make docker-build && make docker-push
    skip_cleanup: true
    on:
      branch: main
      tags: true
  - provider: script
    script: dotnet nuget push **/*.nupkg -k $NUGET_API_KEY -s https://api.nuget.org/v3/index.json
    skip_cleanup: true
    on:
      branch: main
      tags: true

notifications:
  slack:
    if: branch = main
    on_pull_requests: false
    on_success: never
    on_failure: change
    rooms: $SLACK_TOKEN
